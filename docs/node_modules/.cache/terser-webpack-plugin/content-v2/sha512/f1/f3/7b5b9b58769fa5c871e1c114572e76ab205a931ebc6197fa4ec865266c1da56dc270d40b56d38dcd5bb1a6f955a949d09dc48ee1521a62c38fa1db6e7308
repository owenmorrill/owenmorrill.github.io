{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[422],{820:function(e,t,s){\"use strict\";s.r(t);var a=s(56),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"fix-issues\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fix-issues\"}},[e._v(\"#\")]),e._v(\" Fix issues\")]),e._v(\" \"),s(\"p\",[e._v(\"As we now know, Kubernetes is not secure by default. It is beyond the scope of these exercises to provide a deep-dive on this topic, but detailed documentation on \"),s(\"a\",{attrs:{href:\"https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"securing a cluster\"),s(\"OutboundLink\")],1),e._v(\" is readily available. Additional reading is recommended on configuring a \"),s(\"a\",{attrs:{href:\"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"security context\"),s(\"OutboundLink\")],1),e._v(\" for a pod, \"),s(\"a\",{attrs:{href:\"https://kubernetes.io/docs/concepts/policy/pod-security-policy/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"pod security\"),s(\"OutboundLink\")],1),e._v(\" policies, and setting \"),s(\"a\",{attrs:{href:\"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"capabilities\"),s(\"OutboundLink\")],1),e._v(\" for a container.\")]),e._v(\" \"),s(\"p\",[e._v(\"However, for the time being, we will introduce a couple of quick changes to improve our security posture. We will accomplish this by adding a few lines to our Kubernetes manifest.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"securityContext\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"allowPrivilegeEscalation\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[e._v(\"false\")]),e._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"readOnlyRootFilesystem\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[e._v(\"true\")]),e._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"runAsNonRoot\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[e._v(\"true\")]),e._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"capabilities\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"drop\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\" all\\n\")])])]),s(\"p\",[e._v(\"For your convenience, a sample file has already been created for you containing these changes. It is named \"),s(\"a\",{attrs:{href:\"https://github.com/snyk-partners/snyk-azure-resources/blob/master/templates/azure-vote-secure.yaml\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"code\",[e._v(\"azure-vote-secure.yaml\")]),s(\"OutboundLink\")],1),e._v(\" and can be found in the \"),s(\"a\",{attrs:{href:\"https://github.com/snyk-partners/snyk-azure-resources/tree/master/kube-manifests\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"code\",[e._v(\"kube-manifests/\")]),s(\"OutboundLink\")],1),e._v(\" directory of the repository for this workshop.\")]),e._v(\" \"),s(\"p\",[e._v(\"We will then need to apply this new file to our cluster with the following command:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[e._v(\"kubectl apply -f kube-manifests/azure-vote-secure.yaml\\n\")])])]),s(\"p\",[e._v(\"We should see an output similar to the following:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"deployment.apps/azure-vote-back configured\\nservice/azure-vote-back unchanged\\ndeployment.apps/azure-vote-front configured\\nservice/azure-vote-front unchanged\\n\")])])]),s(\"p\",[e._v(\"Notice that the \"),s(\"code\",[e._v(\"deployment\")]),e._v(\" for both the \"),s(\"code\",[e._v(\"vote-back\")]),e._v(\" and \"),s(\"code\",[e._v(\"vote-front\")]),e._v(\" applications show \"),s(\"code\",[e._v(\"configured\")]),e._v(\" whereas the \"),s(\"code\",[e._v(\"service\")]),e._v(\" for each shows as \"),s(\"code\",[e._v(\"unchanged\")]),e._v(\". This is expected since we have defined \"),s(\"code\",[e._v(\"securityContext\")]),e._v(\" for these.\")]),e._v(\" \"),s(\"p\",[e._v(\"We will verify that our changes resolved the issue by checking our project once more. Since we have \"),s(\"code\",[e._v(\"snyk-monitor\")]),e._v(\" running in our cluster we are actively monitoring our workloads.\")]),e._v(\" \"),s(\"p\",[e._v(\"(IMAGE REMOVED!) - (https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk_scan_05.png)\")]),e._v(\" \"),s(\"p\",[e._v(\"Success! We've been able to identify security issues in our Kubernetes configuration, updating our manifest to include a fix, and applied these to resolve the problem.\")])])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}