{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{554:function(t,a,s){\"use strict\";s.r(a);var e=s(56),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"webhook-tutorial\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#webhook-tutorial\"}},[t._v(\"#\")]),t._v(\" Webhook tutorial\")]),t._v(\" \"),s(\"p\",[t._v('{% hint style=\"info\" %}\\n'),s(\"strong\",[t._v(\"Official\")]),t._v(\" Snyk API is available at \"),s(\"a\",{attrs:{href:\"https://snyk.docs.apiary.io/#\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"https://snyk.docs.apiary.io/#\"),s(\"OutboundLink\")],1),t._v(\"\\n{% endhint %}\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"​integration-example\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#​integration-example\"}},[t._v(\"#\")]),t._v(\" ​Integration example:\")]),t._v(\" \"),s(\"p\",[t._v(\"First of all, we need to create a new Zap in \"),s(\"a\",{attrs:{href:\"https://zapier.com\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Zapier\"),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"h3\",{attrs:{id:\"trigger\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#trigger\"}},[t._v(\"#\")]),t._v(\" Trigger\")]),t._v(\" \"),s(\"p\",[t._v(\"In order to have an access to request headers, we need to create \"),s(\"strong\",[t._v('\"Catch Raw Hook\"')]),t._v(\" trigger. It comes with a disadvantage that request payload will be provided as a string and we will need to parse it to the JSON.\")]),t._v(\" \"),s(\"p\",[t._v(\"![](<../../../.gitbook/assets/untitled (1).png>)\")]),t._v(\" \"),s(\"p\",[t._v(\"It will provide us a Webhook url, were we can send requests:\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-1%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"p\",[t._v(\"Now we need to create a Webhook in Snyk via API with provided url.\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v('POST /api/v1/org/{orgId}/webhooks HTTP/2\\n> Host: snyk.io\\n> Authorization: token {authToken}\\n> Content-Type: application/json\\n| {\\n|   \"url\": \"https://hooks.zapier.com/hooks/catch/9002958/oemlgkz/\",\\n|   \"secret\": \"my-secret-string\"\\n| }\\n')])])]),s(\"p\",[t._v(\"The API will respond with a nearly created Webhook.\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v('< HTTP/2 200 \\n< Content-Type: application/json\\n| {\\n|   \"id\": \"{webhookId}\",\\n|   \"url\": \"https://hooks.zapier.com/hooks/catch/9002958/oemlgkz/\",\\n| }\\n')])])]),s(\"p\",[t._v(\"Now we are able to ping a webhook, in order to test a Zapier's trigger.\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"> POST /api/v1/org/{orgId}/webhooks/{webhookId}/ping HTTP/2\\n> Host: snyk.io\\n> Authorization: token {authToken}\\n> Content-Type: application/json\\n\")])])]),s(\"p\",[t._v(\"Now we will be able to select a ping request from the list, and map fields.\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-2%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"h3\",{attrs:{id:\"action-validate-a-payload\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#action-validate-a-payload\"}},[t._v(\"#\")]),t._v(\" Action (validate a payload)\")]),t._v(\" \"),s(\"p\",[t._v(\"In order to validate a payload, we need to create a JS Action:\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v('\"Code by Zapier\" → \"Run Javascript\"')])]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-3%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"p\",[t._v(\"We need to map \"),s(\"code\",[t._v(\"headers['X-Hub-Signature']\")]),t._v(\" and payload string to the snippet variables.\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-4%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"p\",[t._v(\"Following snippet will introduce a \"),s(\"code\",[t._v(\"isValid: boolean\")]),t._v(\" variable to the Zap's fields.\")]),t._v(\" \"),s(\"p\",[t._v('{% hint style=\"info\" %}\\nReplace '),s(\"code\",[t._v(\"my-secret-string\")]),t._v(\" string with a webhook's secret string.\\n{% endhint %}\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-javascript extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" crypto \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'crypto'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" secret \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"my-secret-string\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"makeSignature\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token parameter\"}},[t._v(\"body\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" secret\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" hmac \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" crypto\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"createHmac\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'sha256'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" secret\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n  hmac\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"update\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"body\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'utf8'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token template-string\"}},[s(\"span\",{pre:!0,attrs:{class:\"token template-punctuation string\"}},[t._v(\"`\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"sha256=\")]),s(\"span\",{pre:!0,attrs:{class:\"token interpolation\"}},[s(\"span\",{pre:!0,attrs:{class:\"token interpolation-punctuation punctuation\"}},[t._v(\"${\")]),t._v(\"hmac\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"digest\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'hex'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token interpolation-punctuation punctuation\"}},[t._v(\"}\")])]),s(\"span\",{pre:!0,attrs:{class:\"token template-punctuation string\"}},[t._v(\"`\")])]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"try\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" body \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"JSON\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"parse\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"inputData\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"body\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" project\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" org\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" group\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" newIssues \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" body\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n  output \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" \\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token literal-property property\"}},[t._v(\"isValid\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\":\")]),t._v(\" inputData\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"signature \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"===\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"makeSignature\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"inputData\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"body\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" secret\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"catch\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"err\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  output \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token literal-property property\"}},[t._v(\"isValid\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[t._v(\"false\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token literal-property property\"}},[t._v(\"err\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\":\")]),t._v(\" err\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"message \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"Test the snippet, make sure \"),s(\"code\",[t._v(\"isValid === true\")]),t._v(\".\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-5%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"h3\",{attrs:{id:\"action-parse-a-payload\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#action-parse-a-payload\"}},[t._v(\"#\")]),t._v(\" Action (parse a payload)\")]),t._v(\" \"),s(\"p\",[t._v(\"Let's create another action, to parse a payload from string to something Zapier can understand.\")]),t._v(\" \"),s(\"p\",[t._v(\"We need to create the same JS Action:\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v('\"Code by Zapier\" → \"Run Javascript\"')]),t._v(\", with the following field mapping:\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-6%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"p\",[t._v(\"And the following JS snippet:\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"try {\\n  output = JSON.parse(inputData.body);\\n} catch (err) {\\n  output = { err: err.message };\\n}\\n\")])])]),s(\"p\",[t._v(\"That will parse a request payload and map it to Zap's variables.\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"action-format-issues\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#action-format-issues\"}},[t._v(\"#\")]),t._v(\" Action (format issues)\")]),t._v(\" \"),s(\"p\",[t._v(\"New issues are provided as a list of objects, unfortunately, Zapier doesn't understand that format well, rather it likes a list of strings. So We need to format \"),s(\"code\",[t._v(\"newIssues\")]),t._v(\" to \"),s(\"code\",[t._v(\"string[]\")]),t._v(\".\")]),t._v(\" \"),s(\"p\",[t._v(\"Let's create one more JS Action:\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v('\"Code by Zapier\" → \"Run Javascript\"')]),t._v(\", and paste the following snippet:\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"function formatIssue({ pkgName, pkgVersions, issueData }) {\\n  return `\\n  <a href=\\\"${issueData.url}\\\">${issueData.title}</a><br/>\\n  Vulnerability in ${pkgName} (${pkgVersions.join(', ')}). ${issueData.severity} severity.\\n`;\\n}\\n\\ntry {\\n  const { newIssues, ...body } = JSON.parse(inputData.body);\\n\\n  output = { ...body, newIssues: newIssues.map(formatIssue) };\\n} catch (err) {\\n  output = { newIssues: [], err: err.message };\\n}\\n\")])])]),s(\"h3\",{attrs:{id:\"action-filter\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#action-filter\"}},[t._v(\"#\")]),t._v(\" Action (filter)\")]),t._v(\" \"),s(\"p\",[t._v(\"Now with all fields provided, we can decide whatever we want to do anything with an event or not.\")]),t._v(\" \"),s(\"p\",[t._v(\"To filter, we need to create \"),s(\"strong\",[t._v('\"Filter by Zapier\"')]),t._v(\" app:\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-7%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"p\",[t._v(\"Now you will be able to choose how you want it to be filtered.\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-8%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"h3\",{attrs:{id:\"action-send-a-notification\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#action-send-a-notification\"}},[t._v(\"#\")]),t._v(\" Action (send a notification)\")]),t._v(\" \"),s(\"p\",[t._v(\"With the actions above, we are able to access all necessary fields, and we can build a notification template. In my case, I choose to send an email. But it can be anything else.\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/untitled-9%20(1).png\",alt:\"\"}})]),t._v(\" \"),s(\"h3\",{attrs:{id:\"result\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#result\"}},[t._v(\"#\")]),t._v(\" Result\")]),t._v(\" \"),s(\"p\",[t._v(\"The notification will look like this:\")])])}),[],!1,null,null,null);a.default=n.exports}}]);","extractedComments":[]}