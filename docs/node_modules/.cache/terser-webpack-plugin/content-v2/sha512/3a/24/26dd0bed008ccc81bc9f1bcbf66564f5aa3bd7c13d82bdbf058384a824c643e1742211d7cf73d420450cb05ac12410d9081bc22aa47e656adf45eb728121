{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[523],{925:function(e,t,a){\"use strict\";a.r(t);var n=a(56),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"adding-kubernetes-workloads-for-security-scanning\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#adding-kubernetes-workloads-for-security-scanning\"}},[e._v(\"#\")]),e._v(\" Adding Kubernetes workloads for security scanning\")]),e._v(\" \"),n(\"p\",[e._v(\"Once an administrator for your Snyk account has installed the Snyk controller on your Kubernetes cluster, add workloads for testing as follows:\")]),e._v(\" \"),n(\"ul\",[n(\"li\",[e._v(\"Snyk collaborators can manually add new Kubernetes projects\")]),e._v(\" \"),n(\"li\",[e._v(\"Kubernetes collaborators can mark workloads from the cluster to be automatically added to Snyk\")])]),e._v(\" \"),n(\"h2\",{attrs:{id:\"prerequisites\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\"}},[e._v(\"#\")]),e._v(\" Prerequisites\")]),e._v(\" \"),n(\"p\",[e._v(\"You must have an account with Snyk and be onboarded to your organization by an administrator.\")]),e._v(\" \"),n(\"p\",[e._v(\"In addition, the integration must be configured between Snyk and your Kubernetes environment per organization. To verify the integration is configured, ensure you have an Integration ID:\")]),e._v(\" \"),n(\"ol\",[n(\"li\",[e._v(\"Navigate to the relevant organization.\")]),e._v(\" \"),n(\"li\",[e._v(\"Click on settings \"),n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/cog_icon.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}}),e._v(\" > \"),n(\"strong\",[e._v(\"Integrations\")]),e._v(\".\")]),e._v(\" \"),n(\"li\",[e._v(\"In the Kubernetes section, click \"),n(\"strong\",[e._v(\"Edit Settings\")]),e._v(\".\")]),e._v(\" \"),n(\"li\",[e._v(\"Scroll to the \"),n(\"strong\",[e._v(\"Integration ID\")]),e._v(\" entry and check this is set.\")])]),e._v(\" \"),n(\"h2\",{attrs:{id:\"automatically-add-update-and-remove-workloads\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#automatically-add-update-and-remove-workloads\"}},[e._v(\"#\")]),e._v(\" Automatically add, update and remove workloads\")]),e._v(\" \"),n(\"p\",[e._v(\"Once you’ve configured the integration between Snyk and your cluster, you can annotate your workloads in order to have them automatically added as projects for testing in Snyk.\")]),e._v(\" \"),n(\"p\",[e._v('{% hint style=\"info\" %}\\nThe annotated import happens when the '),n(\"strong\",[e._v(\"image\")]),e._v(\" itself changes (rescans the workload due to image change) or when the \"),n(\"strong\",[e._v(\"workload details\")]),e._v(\" change (which creates a new revision of the workload). Changing the annotation for the workload will not cause a workload change.\")]),e._v(\" \"),n(\"p\",[e._v(\"If the workload is only annotated after it has been scanned by \"),n(\"code\",[e._v(\"snyk monitor\")]),e._v(\"--the annotation will not be recognized until a significant change takes place that causes a full rescan. Terminating the \"),n(\"code\",[e._v(\"snyk monitor\")]),e._v(\" pod is one way to force a rescan.\\n{% endhint %}\")]),e._v(\" \"),n(\"p\",[e._v(\"Annotate any of the following workload types:\")]),e._v(\" \"),n(\"ul\",[n(\"li\",[e._v(\"Deployments\")]),e._v(\" \"),n(\"li\",[e._v(\"ReplicaSets\")]),e._v(\" \"),n(\"li\",[e._v(\"DaemonSets\")]),e._v(\" \"),n(\"li\",[e._v(\"StatefulSets\")]),e._v(\" \"),n(\"li\",[e._v(\"Jobs\")]),e._v(\" \"),n(\"li\",[e._v(\"CronJobs\")]),e._v(\" \"),n(\"li\",[e._v(\"ReplicationControllers\")]),e._v(\" \"),n(\"li\",[e._v(\"Pods\")])]),e._v(\" \"),n(\"p\",[n(\"strong\",[e._v(\"Steps\")])]),e._v(\" \"),n(\"ol\",[n(\"li\",[e._v(\"Log in to your account and navigate to the relevant group and organization that you want to manage.\")]),e._v(\" \"),n(\"li\",[e._v(\"Click on settings \"),n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/cog_icon.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}}),e._v(\" > \"),n(\"strong\",[e._v(\"General\")]),e._v(\". 3. Copy the \"),n(\"strong\",[e._v(\"Organization ID\")]),e._v(\" value. 4. Add an annotation to the workload with the key \"),n(\"code\",[e._v(\"orgs.k8s.snyk.io/v1\")]),e._v(\" , entering the Organization ID as the value, in a comma-separated list.\")])]),e._v(\" \"),n(\"p\",[e._v(\"You can also annotate a single workload to be added to multiple organizations.\")]),e._v(\" \"),n(\"ol\",[n(\"li\",[n(\"p\",[e._v(\"Now, the Snyk controller automatically picks up on the changes to your workload and ensures that the workload is automatically imported to Snyk as a Snyk project.\")]),e._v(\" \"),n(\"p\",[e._v(\"Example 1. Example of a Deployment YAML file annotated to be automatically imported into an organization\")]),e._v(\" \"),n(\"div\",{staticClass:\"language-text extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[e._v(\"apiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: my-app-deployment\\n  annotations:\\n    orgs.k8s.snyk.io/v1: cacb791e-07cc-4b10-b4be-64de19f532f1\\nspec:\\n  template:\\n    spec:\\n      containers:\\n      …\\n\")])])]),n(\"p\",[e._v(\"To annotate for multiple organizations, use a comma-separated list.\")])]),e._v(\" \"),n(\"li\",[n(\"p\",[e._v(\"Once imported, the project remains in your Snyk organization even if you remove the annotation. To remove the project from Snyk, you should delete the annotation and delete it from the Snyk UI or \"),n(\"a\",{attrs:{href:\"https://snyk.docs.apiary.io/#reference/projects/individual-project/delete-a-project\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"with the API\"),n(\"OutboundLink\")],1),e._v(\".\")])])]),e._v(\" \"),n(\"h2\",{attrs:{id:\"manually-add-workloads\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#manually-add-workloads\"}},[e._v(\"#\")]),e._v(\" Manually add workloads\")]),e._v(\" \"),n(\"p\",[e._v(\"Go to the \"),n(\"strong\",[e._v(\"Projects page\")]),e._v(\", click \"),n(\"strong\",[e._v(\"Add project\")]),e._v(\" and select the \"),n(\"strong\",[e._v(\"Kubernetes\")]),e._v(\" option.\")]),e._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/uuid-619a153d-6c77-f7dc-854c-ff77b3173191-en.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}})]),e._v(\" \"),n(\"p\",[e._v(\"The import screen loads, similar to the one below, displaying all namespaces from the Kubernetes environment on the left and relevant namespace workloads on the right:\")]),e._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/uuid-3a8568e0-b5a4-34af-d612-83466b206882-en.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}})]),e._v(\" \"),n(\"p\",[e._v(\"We purposely ignore scanning certain namespaces which we believe are internal to Kubernetes (any namespace starting with \"),n(\"em\",[n(\"strong\",[e._v(\"kube-*\")])]),e._v(\"), therefore you won't see those namespaces in the list, as well as the workloads they contain.\"),n(\"br\"),e._v(\"\\nThe full list of ignored namespaces can be found \"),n(\"a\",{attrs:{href:\"https://github.com/snyk/kubernetes-monitor/blob/master/src/supervisor/watchers/internal-namespaces.ts\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"here\"),n(\"OutboundLink\")],1),e._v(\". This can be configured by adding the following to helm when setting up the snyk-monitor:\")]),e._v(\" \"),n(\"div\",{staticClass:\"language-text extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[e._v(\"      --set excludedNamespaces={kube-node-lease,local-path-storage,some_namespace}\\n\")])])]),n(\"ul\",[n(\"li\",[e._v(\"Select one or multiple namespaces from the left side and for each namespace, select one or multiple workloads to import from the right side.\")])]),e._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/uuid-27db0a60-f18d-5ab0-9215-5a81e467f013-en.gif'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"Select_namespace.gif\"}})]),e._v(\" \"),n(\"ul\",[n(\"li\",[e._v(\"When ready, click \"),n(\"strong\",[e._v(\"Add selected workloads\")]),e._v(\" from the top right of the screen. When the import completes, the Projects page loads and all workloads that you’ve imported appear, with a unique Kubernetes icon:\")])]),e._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/uuid-24e0b69a-01c3-9434-9dac-9b44864bd269-en.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"Kubernetes icon\"}})]),e._v(\" \"),n(\"p\",[e._v(\"Each item is named according to its Kubernetes metadata as follows: \"),n(\"strong\",[e._v(\"<namespace>/<kind>/<name>\")]),e._v(\".\")]),e._v(\" \"),n(\"p\",[e._v(\"You can filter for Kubernetes projects only:\")]),e._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/image%20%285%29.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}})])])}),[],!1,null,null,null);t.default=o.exports}}]);","extractedComments":[]}