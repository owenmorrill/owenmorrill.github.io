{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[527],{924:function(e,t,a){\"use strict\";a.r(t);var o=a(56),r=Object(o.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[o(\"h1\",{attrs:{id:\"install-the-snyk-controller-on-amazon-elastic-kubernetes-service-amazon-eks\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#install-the-snyk-controller-on-amazon-elastic-kubernetes-service-amazon-eks\"}},[e._v(\"#\")]),e._v(\" Install the Snyk controller on Amazon Elastic Kubernetes Service (Amazon EKS)\")]),e._v(\" \"),o(\"p\",[e._v(\"Installing the Snyk controller enables you to import and test your running EKS workloads and identify vulnerabilities in their associated images and configurations that might make those workloads less secure. Once imported, Snyk continues to monitor those workloads, identifying additional security issues as new images are deployed and the workload configuration changes.\")]),e._v(\" \"),o(\"h3\",{attrs:{id:\"open-the-aws-quick-start-guide\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#open-the-aws-quick-start-guide\"}},[e._v(\"#\")]),e._v(\" \"),o(\"a\",{attrs:{href:\"https://aws.amazon.com/quickstart/architecture/eks-snyk/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Open the AWS Quick Start Guide\"),o(\"OutboundLink\")],1)]),e._v(\" \"),o(\"p\",[e._v(\"You have the option of deploying the Snyk controller for Amazon EKS as an official \"),o(\"a\",{attrs:{href:\"https://aws.amazon.com/quickstart/architecture/eks-snyk/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"AWS Quick Start\"),o(\"OutboundLink\")],1),e._v(\". This option eliminates the need for manual configuration. Deploying this Quick Start with default parameters into an existing Amazon EKS cluster builds the following environment.\")]),e._v(\" \"),o(\"p\",[o(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/architecture.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}})]),e._v(\" \"),o(\"p\",[e._v(\"There are three deployment options to match most common use cases. These are as follows:\")]),e._v(\" \"),o(\"p\",[o(\"strong\",[e._v(\"1.\")]),e._v(\" If you already have an Amazon EKS cluster running in your AWS account\")]),e._v(\" \"),o(\"p\",[o(\"a\",{attrs:{href:\"https://us-east-2.console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks/create/template?stackName=Snyk-EKS&templateURL=https://aws-quickstart.s3.us-east-1.amazonaws.com/quickstart-amazon-eks/submodules/quickstart-eks-snyk/templates/eks-snyk.template.yaml\",target:\"_blank\",rel:\"noopener noreferrer\"}},[o(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/cloudformation-launch-stack.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"cloudformation-launch-stack.png - REPLACE THIS IMAGE - ZENDESK IMAGE - UPDATE ME!\"}}),o(\"OutboundLink\")],1)]),e._v(\" \"),o(\"p\",[o(\"strong\",[e._v(\"2.\")]),e._v(\" If you already have an Amazon Virtual Private Cloud (Amazon VPC) but need an Amazon EKS cluster \"),o(\"em\",[o(\"strong\",[e._v(\"with\")])]),e._v(\" the Snyk controller deployed to the cluster\")]),e._v(\" \"),o(\"p\",[o(\"a\",{attrs:{href:\"https://us-east-2.console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks/create/template?stackName=Amazon-EKS-with-Snyk&templateURL=https://aws-quickstart.s3.us-east-1.amazonaws.com/quickstart-amazon-eks/templates/amazon-eks-master-existing-vpc.template.yaml\",target:\"_blank\",rel:\"noopener noreferrer\"}},[o(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/cloudformation-launch-stack.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"cloudformation-launch-stack.png - REPLACE THIS IMAGE - ZENDESK IMAGE - UPDATE ME!\"}}),o(\"OutboundLink\")],1)]),e._v(\" \"),o(\"p\",[o(\"strong\",[e._v(\"3.\")]),e._v(\" If you have neither an Amazon VPC or Amazon EKS cluster and need all services \"),o(\"em\",[o(\"strong\",[e._v(\"with\")])]),e._v(\" the Snyk controller deployed to the cluster\")]),e._v(\" \"),o(\"p\",[o(\"a\",{attrs:{href:\"https://us-east-2.console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks/create/template?stackName=Amazon-EKS-with-Snyk&templateURL=https://aws-quickstart.s3.us-east-1.amazonaws.com/quickstart-amazon-eks/templates/amazon-eks-master-existing-vpc.template.yaml\",target:\"_blank\",rel:\"noopener noreferrer\"}},[o(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/cloudformation-launch-stack.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"cloudformation-launch-stack.png - REPLACE THIS IMAGE - ZENDESK IMAGE - UPDATE ME!\"}}),o(\"OutboundLink\")],1)]),e._v(\" \"),o(\"p\",[o(\"strong\",[e._v(\"NOTE:\")]),e._v(\" \"),o(\"em\",[e._v(\"Please review the\")]),e._v(\" \"),o(\"a\",{attrs:{href:\"https://github.com/aws-quickstart/quickstart-eks-snyk#parameter-reference\",target:\"_blank\",rel:\"noopener noreferrer\"}},[o(\"em\",[e._v(\"parameter reference\")]),o(\"OutboundLink\")],1),e._v(\" \"),o(\"em\",[e._v(\"prior to deployment.\")])]),e._v(\" \"),o(\"h2\",{attrs:{id:\"prerequisites\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\"}},[e._v(\"#\")]),e._v(\" \"),o(\"strong\",[e._v(\"Prerequisites\")])]),e._v(\" \"),o(\"p\",[e._v('{% hint style=\"info\" %}\\n'),o(\"strong\",[e._v(\"Feature availability\")]),o(\"br\"),e._v(\"\\nThis feature is available with all paid plans. See \"),o(\"a\",{attrs:{href:\"https://snyk.io/plans/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"pricing plans\"),o(\"OutboundLink\")],1),e._v(\" for more details.\\n{% endhint %}\")]),e._v(\" \"),o(\"ul\",[o(\"li\",[e._v(\"An administrator account for your Snyk organization.\")]),e._v(\" \"),o(\"li\",[e._v(\"A minimum of 50 GB of storage must be available in the form of an \"),o(\"a\",{attrs:{href:\"https://kubernetes.io/docs/concepts/storage/volumes/#emptydir\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"emptyDir\"),o(\"OutboundLink\")],1),e._v(\" on the cluster.\")]),e._v(\" \"),o(\"li\",[e._v(\"Your Kubernetes cluster needs to be able to communicate with Snyk outbound over HTTPS.\")]),e._v(\" \"),o(\"li\",[e._v(\"When configuring Snyk to integrate with an Amazon Elastic Kubernetes Services (EKS) cluster, if you wish to scan images hosted on your Amazon Elastic Container Registry (ECR), you may also deploy our Quick Start, \"),o(\"a\",{attrs:{href:\"https://aws.amazon.com/quickstart/architecture/snyk-security/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Snyk Security on AWS\"),o(\"OutboundLink\")],1),e._v(\" to enable this integration.\")])]),e._v(\" \"),o(\"p\",[o(\"img\",{attrs:{src:a(!function(){var e=new Error(\"Cannot find module '../../../../.gitbook/assets/snyk_rocket.png'\");throw e.code=\"MODULE_NOT_FOUND\",e}()),alt:\"\"}})]),e._v(\" \"),o(\"h2\",{attrs:{id:\"deployment-guide\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#deployment-guide\"}},[e._v(\"#\")]),e._v(\" \"),o(\"a\",{attrs:{href:\"https://aws-quickstart.github.io/quickstart-eks-snyk/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Deployment Guide\"),o(\"OutboundLink\")],1)]),e._v(\" \"),o(\"h2\",{attrs:{id:\"configure-snyk-controller-to-pull-and-scan-private-images-from-ecr\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#configure-snyk-controller-to-pull-and-scan-private-images-from-ecr\"}},[e._v(\"#\")]),e._v(\" Configure Snyk Controller to pull and scan private images from ECR\")]),e._v(\" \"),o(\"p\",[e._v(\"Ensure your \"),o(\"strong\",[e._v(\"dockerconfig.json\")]),e._v(\" matches the example below:\")]),e._v(\" \"),o(\"div\",{staticClass:\"language- extra-class\"},[o(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[o(\"code\",[e._v('{\\n    \"credsStore\": \"ecr-login\"\\n  }\\n')])])]),o(\"h3\",{attrs:{id:\"attach-policies-for-worker-nodes\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#attach-policies-for-worker-nodes\"}},[e._v(\"#\")]),e._v(\" Attach policies for worker nodes\")]),e._v(\" \"),o(\"p\",[e._v(\"For all the options above, attach the \"),o(\"strong\",[e._v(\"NodeInstanceRole\")]),e._v(\" policy that can be found \"),o(\"a\",{attrs:{href:\"https://docs.aws.amazon.com/AmazonECR/latest/userguide/ECR_on_EKS.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"here\"),o(\"OutboundLink\")],1),e._v(\" with the \"),o(\"strong\",[e._v(\"AmazonEC2ContainerRegistryReadOnly\")]),e._v(\" policy to your EKS worker nodes. The Snyk Controller should now be able to pull private images when running on those worker nodes.\")]),e._v(\" \"),o(\"p\",[e._v(\"Alternatively, you can also use the IAM role for Service Accounts by \"),o(\"strong\",[e._v(\"creating an EKS node role for your Node Group\")]),e._v(\" (no need to set up an extra OIDC service account role), and configure the Snyk Controller as follows:\")]),e._v(\" \"),o(\"h3\",{attrs:{id:\"create-an-eks-node-role-for-your-node-group\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#create-an-eks-node-role-for-your-node-group\"}},[e._v(\"#\")]),e._v(\" Create an EKS node role for your Node Group\")]),e._v(\" \"),o(\"ul\",[o(\"li\",[e._v(\"Following the instruction \"),o(\"a\",{attrs:{href:\"https://docs.aws.amazon.com/eks/latest/userguide/create-node-role.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"here\"),o(\"OutboundLink\")],1),e._v(\", check your existing node role. Make sure you have attached the policy \"),o(\"strong\",[e._v(\"AmazonEC2ContainerRegistryReadOnly.\")])]),e._v(\" \"),o(\"li\",[e._v(\"Select the \"),o(\"strong\",[e._v(\"Details\")]),e._v(\" tab on your EKS node group page, where you should see \"),o(\"strong\",[e._v(\"Node IAM Role ARN.\")]),e._v(\" It should look something like this:\")])]),e._v(\" \"),o(\"div\",{staticClass:\"language- extra-class\"},[o(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[o(\"code\",[e._v(\"arn:aws:iam::<role-id>:role/<role-name>\\n\")])])]),o(\"ul\",[o(\"li\",[e._v(\"Create a YAML file with the following content:\")])]),e._v(\" \"),o(\"div\",{staticClass:\"language- extra-class\"},[o(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[o(\"code\",[e._v(\" volumes:\\n  projected:\\n    serviceAccountToken: true\\n\\nrbac:\\n  serviceAccount:\\n    annotations:\\n      eks.amazonaws.com/role-arn: <Node IAM Role ARN>\\n\")])])]),o(\"h3\",{attrs:{id:\"install-snyk-controller\"}},[o(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#install-snyk-controller\"}},[e._v(\"#\")]),e._v(\" Install Snyk Controller\")]),e._v(\" \"),o(\"p\",[e._v(\"After creating the IAM role for your Service Account, you can now install your Snyk Controller with this newly created YAML file to overwrite the values in the Helm chart.\")]),e._v(\" \"),o(\"div\",{staticClass:\"language- extra-class\"},[o(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[o(\"code\",[e._v(\"helm upgrade --install snyk-monitor snyk-charts/snyk-monitor \\\\\\n             --namespace snyk-monitor \\\\\\n             -f <newFile>.yaml\\n\")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}