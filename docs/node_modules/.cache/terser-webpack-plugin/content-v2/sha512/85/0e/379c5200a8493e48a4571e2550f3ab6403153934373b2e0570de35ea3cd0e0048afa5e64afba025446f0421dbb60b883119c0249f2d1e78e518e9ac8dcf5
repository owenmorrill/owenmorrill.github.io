{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[883],{1286:function(e,t,s){\"use strict\";s.r(t);var a=s(56),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"configure-the-acr-integration\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#configure-the-acr-integration\"}},[e._v(\"#\")]),e._v(\" Configure the ACR integration\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"create-a-service-principal\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#create-a-service-principal\"}},[e._v(\"#\")]),e._v(\" Create a service principal\")]),e._v(\" \"),s(\"p\",[e._v(\"It is recommended that you assign a \"),s(\"a\",{attrs:{href:\"https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"service principal\"),s(\"OutboundLink\")],1),e._v(\" to your registry. Please review the \"),s(\"a\",{attrs:{href:\"https://docs.microsoft.com/en-us/azure/container-registry/container-registry-authentication\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Authenticate with an Azure container registry\"),s(\"OutboundLink\")],1),e._v(\" documentation for further information on this topic.\")]),e._v(\" \"),s(\"p\",[e._v(\"To simplify this process, you will find a sample \"),s(\"code\",[e._v(\"bash\")]),e._v(\" script in the \"),s(\"code\",[e._v(\"scripts/\")]),e._v(\" directory of your cloned repo. From the terminal, let's make sure we are at the root of our cloned repository by typing \"),s(\"code\",[e._v(\"pwd\")]),e._v(\" and verifying the result displays \"),s(\"code\",[e._v(\"$HOME/snyk-azure-resources/\")]),e._v(\".\")]),e._v(\" \"),s(\"p\",[e._v(\"Then, let's change directory by typing the following command:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[e._v(\"cd\")]),e._v(\" scripts/\\n\")])])]),s(\"p\",[e._v(\"From here, a simple \"),s(\"code\",[e._v(\"ls -a\")]),e._v(\" command will show the contents and you will see the \"),s(\"code\",[e._v(\"create-acr-service-principal.sh\")]),e._v(\" script in that directory. You can open this in your favorite editor like \"),s(\"a\",{attrs:{href:\"https://code.visualstudio.com/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Microsoft Visual Studio Code\"),s(\"OutboundLink\")],1),e._v(\" and review the contents.\")]),e._v(\" \"),s(\"p\",[e._v(\"These will look like this:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token shebang important\"}},[e._v(\"#!/bin/bash\")]),e._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Modify for your environment.\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# ACR_NAME: The name of your Azure Container Registry\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# SERVICE_PRINCIPAL_NAME: Must be unique within your AD tenant\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[e._v(\"ACR_NAME\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"${1}\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[e._v(\"SERVICE_PRINCIPAL_NAME\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),e._v(\"acr-service-principal\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Obtain the full registry ID for subsequent command args\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[e._v(\"ACR_REGISTRY_ID\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$(\")]),e._v(\"az acr show --name $ACR_NAME --query \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"id\")]),e._v(\" --output tsv\"),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\")\")])]),e._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Create the service principal with rights scoped to the registry.\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Default permissions are for docker pull access. Modify the '--role'\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# argument value as desired:\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# acrpull:     pull only\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# acrpush:     push and pull\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# owner:       push, pull, and assign roles\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[e._v(\"SP_PASSWD\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$(\")]),e._v(\"az ad sp create-for-rbac --name http://$SERVICE_PRINCIPAL_NAME --scopes $ACR_REGISTRY_ID --role acrpull --query password --output tsv\"),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\")\")])]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[e._v(\"SP_APP_ID\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$(\")]),e._v(\"az ad sp show --id http://$SERVICE_PRINCIPAL_NAME --query appId --output tsv\"),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\")\")])]),e._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Output the service principal's credentials; use these in your services and\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# applications to authenticate to the container registry.\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[e._v(\"echo\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[e._v('\"Service principal ID: '),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$SP_APP_ID\")]),e._v('\"')]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[e._v(\"echo\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[e._v('\"Service principal password: '),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$SP_PASSWD\")]),e._v('\"')]),e._v(\"\\n\")])])]),s(\"p\",[e._v(\"To run the script simply invoke it from the present working directory and pass the ACR name, \"),s(\"code\",[e._v(\"mysnykcontainerregistry\")]),e._v(\" as a parameter as follows:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[e._v(\"./create-acr-service-principal.sh mysnykcontainerregistry\\n\")])])]),s(\"p\",[e._v(\"Upon successful completion, you will see results similar to the following:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v('Creating a role assignment under the scope of \"/subscriptions/&lt;guid>/resourceGroups/mySnykACRResourceGroup/providers/Microsoft.ContainerRegistry/registries/mySnykContainerRegistry\"\\n  Retrying role assignment creation: 1/36\\nService principal ID: &lt;guid>\\nService principal password: &lt;guid>\\n')])])]),s(\"p\",[e._v(\"Take note of the values for \"),s(\"code\",[e._v(\"Service principal ID\")]),e._v(\" and \"),s(\"code\",[e._v(\"Service principal password\")]),e._v(\". You will need these to configure the integration in the following steps so \"),s(\"strong\",[e._v(\"DO NOT\")]),e._v(\" close or clear your terminal window.\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"enable-the-integration\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#enable-the-integration\"}},[e._v(\"#\")]),e._v(\" Enable the integration\")]),e._v(\" \"),s(\"p\",[e._v(\"From the Snyk web console, navigate to \"),s(\"code\",[e._v(\"Integrations\")]),e._v(\". Search and select \"),s(\"code\",[e._v(\"ACR\")]),e._v(\". Click the tile.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk_integrations_07.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Follow the steps outlined in the following diagram and provide the \"),s(\"code\",[e._v(\"Service principal ID\")]),e._v(\" \"),s(\"code\",[e._v(\"Service principal password\")]),e._v(\" and \"),s(\"code\",[e._v(\"loginServer\")]),e._v(\" value for your ACR instance:\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk_integrations_06.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Remember to save your settings!\")])])}),[],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}