{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[758],{1157:function(e,t,a){\"use strict\";a.r(t);var o=a(56),n=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"rce-vulnerability\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#rce-vulnerability\"}},[e._v(\"#\")]),e._v(\" RCE Vulnerability\")]),e._v(\" \"),a(\"p\",[e._v(\"During the workshop, we \"),a(\"RouterLink\",{attrs:{to:\"/snyk/tutorials/atlassian/devops-pipeline-with-bitbucket-cloud-and-kubernetes/module-1-scanning-and-monitoring-source-code/review-application-scan-results.html\"}},[e._v(\"draw attention \")]),e._v(\"to the top-level Docker image vulnerability and explain how the base image can be upgraded.  We reviewed a vulnerability and included a screenshot for the Tomcat version.  In this section, we will be exploiting the version of Tomcat in the repository.\")],1),e._v(\" \"),a(\"p\",[e._v(\"The \"),a(\"a\",{attrs:{href:\"https://github.com/snyk-labs/java-goof/blob/master/exploits/tomcat-rce/README.md\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"README.md\"),a(\"OutboundLink\")],1),e._v(\" contents are fairly comprehensive about what to do.  The unifying story here is how an external user can exploit a vulnerability of your application based on its use of third-party software.  In this case, it is the application server Tomcat.\")]),e._v(\" \"),a(\"p\",[e._v(\"The exploit sets up a webform where you can run commands.  Some of these commands include \"),a(\"code\",[e._v(\"whoami\")]),e._v(\" and \"),a(\"code\",[e._v(\"dpkg -l\")]),e._v(\" but may also include other commands that echo the contents of \"),a(\"code\",[e._v(\"/etc/passwd\")]),e._v(\" or \"),a(\"code\",[e._v(\"touch\")]),e._v(\".  When we run the workshop, we'll showcase a number of interesting commands including:\")]),e._v(\" \"),a(\"ul\",[a(\"li\",[a(\"code\",[e._v(\"cat etc/passwd\")])]),e._v(\" \"),a(\"li\",[a(\"code\",[e._v(\"touch <filename>\")])]),e._v(\" \"),a(\"li\",[a(\"code\",[e._v(\"touch /etc/testfile\")])]),e._v(\" \"),a(\"li\",[a(\"code\",[e._v(\"curl\")])])]),e._v(\" \"),a(\"p\",[e._v(\"These commands are representative of what attackers may use to explore what is available on your vulnerable system.  They don't use ssh to access your system, but instead find a way to run shell commands to exploit your system.  We recommend you try various commands to become acquainted with what is available on this vulnerable system.\")]),e._v(\" \"),a(\"p\",[e._v(\"When you run through the commands to patch the system and re-check, you'll see the vulnerability is no longer there.  While we're running commands at the CLI, it is worth noting the contents of the file \"),a(\"code\",[e._v(\"tomcat-rce.sh\")]),e._v(\" are:\")]),e._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v('#!/usr/bin/env bash\\n\\nHOSTIP=\"$(ifconfig | grep -Eo \\'inet (addr:)?([0-9]*\\\\.){3}[0-9]*\\' | grep -Eo \\'([0-9]*\\\\.){3}[0-9]*\\' | grep -v \\'127.0.0.1\\' | head -1):8080\"\\n\\nLB_HOST=$(kubectl get svc goof -o json | jq -r .status.loadBalancer.ingress[0].hostname)\\nif [[ \"$LB_HOST\" != \"\" ]]; then\\n    HOSTIP=$LB_HOST\\nfi\\n\\necho Detected $HOSTIP as target host\\ndocker build -t tomcat-rce tomcat-rce\\nalias check=\"docker run --rm -it tomcat-rce -u http://${HOSTIP}\"\\nalias pwn=\"docker run --rm -it tomcat-rce -u http://${HOSTIP} -p pwn\"\\nalias bounce=\"kubectl delete pod --selector app=goof\"\\nalias browse=\"open http://${HOSTIP}\"\\n')])])]),a(\"p\",[e._v(\"You may be wondering what the different URL commands are and how they work.  Here we recommend you review the Dockerfile to see we're building a container that is deliberately vulnerable and it is accepting parameters to perform actions on our behalf.  This is because we've uploaded a file to grant us access into the container.  This is because \"),a(\"a\",{attrs:{href:\"https://security.snyk.io/vuln/SNYK-JAVA-ORGAPACHETOMCAT-451514\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"CVE-2017-12617\"),a(\"OutboundLink\")],1),e._v(\" is an arbitrary code execution vulnerability, and we're sending in arbitrary code to run!\")]),e._v(\" \"),a(\"p\",[e._v(\"The solution to this vulnerability is to use a newer version of tomcat.  When we patch the Dockerfile to use a newer version, the vulnerability goes away.\")])])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}