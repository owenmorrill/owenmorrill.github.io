{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[375],{777:function(e,t,s){\"use strict\";s.r(t);var a=s(56),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"select-the-most-secure-base-image-available\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#select-the-most-secure-base-image-available\"}},[e._v(\"#\")]),e._v(\" Select the most secure base image available\")]),e._v(\" \"),s(\"p\",[e._v(\"Snyk makes selecting a secure base image for your container easy. We'll show you how to get base image suggestions in both the Snyk UI, and using Docker Desktop.\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"base-image-suggestions-in-docker-desktop\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#base-image-suggestions-in-docker-desktop\"}},[e._v(\"#\")]),e._v(\" Base image suggestions in Docker Desktop\")]),e._v(\" \"),s(\"p\",[e._v(\"Developers can \"),s(\"code\",[e._v(\"docker scan\")]),e._v(\" containers to get vulnerability information and base image upgrade guidance. Scan the image by running the following command. Passing the \"),s(\"code\",[e._v(\"Dockerfile\")]),e._v(\" used to build the image using \"),s(\"code\",[e._v(\"--file\")]),e._v(\" is needed to receive base image suggestions.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"docker scan $DockerId/goof:dev --file=Dockerfile\\n\")])])]),s(\"p\",[e._v('{% hint style=\"info\" %}\\nLearn what else is possible with Docker Scan with '),s(\"a\",{attrs:{href:\"https://snyk.io/blog/docker-security-scanning-cheatsheet-2021/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"our handy cheat sheet\"),s(\"OutboundLink\")],1),e._v(\".\\n{% endhint %}\")]),e._v(\" \"),s(\"p\",[e._v(\"Snyk recommends less vulnerable base images grouped by how likely they are to be compatible:\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[s(\"code\",[e._v(\"Minor\")]),e._v(\" upgrades are the most likely to be compatible with little work,\")]),e._v(\" \"),s(\"li\",[s(\"code\",[e._v(\"Major\")]),e._v(\" upgrades can introduce breaking changes depending on image usage,\")]),e._v(\" \"),s(\"li\",[s(\"code\",[e._v(\"Alternative\")]),e._v(\" architecture images are shown for more technical users to investigate.\")])]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/docker-scanvulns.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Next we'll show you how you can get these same base image suggestions inside the Snyk UI.\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"base-image-suggestions-in-snyk\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#base-image-suggestions-in-snyk\"}},[e._v(\"#\")]),e._v(\" Base image suggestions in Snyk\")]),e._v(\" \"),s(\"h3\",{attrs:{id:\"step-1-configure-snyk-s-github-integration\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#step-1-configure-snyk-s-github-integration\"}},[e._v(\"#\")]),e._v(\" Step 1: Configure Snyk's GitHub Integration\")]),e._v(\" \"),s(\"p\",[e._v('{% hint style=\"info\" %}\\nIf you\\'ve already configured the Snyk GitHub integration, continue to Step 2.\\n{% endhint %}')]),e._v(\" \"),s(\"p\",[e._v(\"First we need to connect Snyk to GitHub so we can import our Repository. Do so by:\")]),e._v(\" \"),s(\"ol\",[s(\"li\",[e._v(\"Logging in to Snyk.io. \"),s(\"a\",{attrs:{href:\"https://snyk.co/SnykGH\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Sign up\"),s(\"OutboundLink\")],1),e._v(\" if you haven't already.\")]),e._v(\" \"),s(\"li\",[e._v(\"Navigating to Integrations -> Source Control -> GitHub\")]),e._v(\" \"),s(\"li\",[e._v(\"Fill in your Account Credentials to Connect your GitHub Account.\")])]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk-gh.png\",alt:\"\"}})]),e._v(\" \"),s(\"h3\",{attrs:{id:\"step-2-import-the-forked-repo-into-snyk\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#step-2-import-the-forked-repo-into-snyk\"}},[e._v(\"#\")]),e._v(\" Step 2: Import the forked Repo into Snyk\")]),e._v(\" \"),s(\"p\",[e._v(\"Now that Snyk is connected to your GitHub Account, import the Repo into Snyk as a Project.\")]),e._v(\" \"),s(\"ol\",[s(\"li\",[e._v(\"Navigate to Projects\")]),e._v(\" \"),s(\"li\",[e._v('Click \"Add Project\" then select \"GitHub\"')]),e._v(\" \"),s(\"li\",[e._v(\"Click on the Repo you created.\")])]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk-ghimport.png\",alt:\"\"}})]),e._v(\" \"),s(\"h3\",{attrs:{id:\"step-3-explore-base-image-suggestions-for-your-app\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#step-3-explore-base-image-suggestions-for-your-app\"}},[e._v(\"#\")]),e._v(\" Step 3: Explore Base Image suggestions for your app\")]),e._v(\" \"),s(\"p\",[e._v(\"When the Repo imports, Snyk shows the supported manifest files in the repo, including our container's \"),s(\"code\",[e._v(\"Dockerfile\")]),e._v(\".\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk-proj-dockerfile.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Clicking the Dockerfile brings you to the project view, where you can see the base image suggestions.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk-baseimagerecs.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Up next, we'll scan the containers running in our Kubernetes cluster for vulnerabilities and base image upgrade guidance. This use case is helpful when running images not developed in-house.\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"optional-finding-vulnerabilities-in-running-workloads\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#optional-finding-vulnerabilities-in-running-workloads\"}},[e._v(\"#\")]),e._v(\" Optional: Finding vulnerabilities in running workloads\")]),e._v(\" \"),s(\"p\",[e._v(\"Snyk's Kubernetes Monitor allows you to find vulnerabilities in workloads running in your cluster. In this section we'll deploy the Snyk Kubernetes Monitor to scan the goof application.\")]),e._v(\" \"),s(\"p\",[e._v('{% hint style=\"info\" %}\\nThis section is optional because the Kubernetes Monitor requires a Snyk Standard plan or higher. Contact us via Intercom if you\\'re a free user and want to evaluate this functionality.\\n{% endhint %}')]),e._v(\" \"),s(\"p\",[e._v('{% hint style=\"info\" %}\\nThe full '),s(\"a\",{attrs:{href:\"https://support.snyk.io/hc/en-us/articles/360003916158#UUID-753328ea-3d73-0eeb-4301-c22522273797\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"instructions for deploying the Kubernetes Monitor\"),s(\"OutboundLink\")],1),e._v(\" can be found in our Docs.\\n{% endhint %}\")]),e._v(\" \"),s(\"p\",[e._v(\"To get started, first create a namespace for the Snyk Monitor:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"kubectl create ns snyk-monitor\\n\")])])]),s(\"p\",[e._v(\"Next, retrieve your Kubernetes Integration ID from Snyk's Integrations menu.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://support.snyk.io/hc/article_attachments/360007147458/uuid-26f9c2cd-2755-07d5-61a0-bdb0261d87ab-en.gif\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Save the integration ID as an Environment Variable to copy-paste the next command.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"IntegrationId=&lt;&lt;your_integration_id>>\\n\")])])]),s(\"p\",[e._v(\"Create a secret in the cluster containing the Integration ID.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v(\"kubectl create secret generic snyk-monitor -n snyk-monitor \\\\\\n        --from-literal=dockercfg.json={} \\\\\\n        --from-literal=integrationId=$IntegrationId\\n\")])])]),s(\"p\",[e._v(\"Now deploy the Kubernetes monitor using Helm:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-text extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[e._v('helm upgrade --install snyk-monitor snyk-charts/snyk-monitor \\\\\\n             --namespace snyk-monitor \\\\\\n             --set clusterName=\"Docker Desktop\"\\n')])])]),s(\"p\",[e._v(\"When it finishes deploying, you'll be able to import the cluster workloads into Snyk.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/k8s-import.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Select to import both the \"),s(\"code\",[e._v(\"goof\")]),e._v(\" and \"),s(\"code\",[e._v(\"mongo\")]),e._v(\" deployments.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/k8simport2.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"When the import completes, they will show up next to the other projects in the Snyk dashboard.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/k8sworkloads.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Since it's the same container, clicking the \"),s(\"code\",[e._v(\"snyk-docker/deployment.apps/goof\")]),e._v(\" project will show the same vulnerabilities as the \"),s(\"code\",[e._v(\"Dockerfile\")]),e._v(\" project from the previous section.\")]),e._v(\" \"),s(\"p\",[e._v(\"You can point the Kubernetes project at the \"),s(\"code\",[e._v(\"Dockerfile\")]),e._v(\" to see base image suggestions.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/k8ssettings.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"This will provide the same base image suggestions for running workloads. We can see that using a different base image can address hundreds of vulnerabilities. This is a relatively low effort fix with huge payoff. Let's apply a more secure base for our application.\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"choose-a-more-secure-base-image\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#choose-a-more-secure-base-image\"}},[e._v(\"#\")]),e._v(\" Choose a more secure base image\")]),e._v(\" \"),s(\"p\",[e._v(\"Open the \"),s(\"code\",[e._v(\"Dockerfile\")]),e._v(\" with a text editor, and replace, or comment out, the old base image with a new one. In this example, we'll use \"),s(\"code\",[e._v(\"node:10.23.1\")]),e._v(\".\")]),e._v(\" \"),s(\"p\",[e._v('{% code title=\"Dockerfile\" %}')]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[e._v(\"FROM node:10.23.1\\n\\nRUN \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"mkdir\")]),e._v(\" /usr/src/goof\\nRUN \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"mkdir\")]),e._v(\" /tmp/extracted_files\\nCOPY \"),s(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[e._v(\".\")]),e._v(\" /usr/src/goof\\nWORKDIR /usr/src/goof\\n\\nRUN \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"npm\")]),e._v(\" update\\nRUN \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"npm\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"install\")]),e._v(\"\\nEXPOSE \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"3001\")]),e._v(\"\\nEXPOSE \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"9229\")]),e._v(\"\\nENTRYPOINT \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"[\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[e._v('\"npm\"')]),e._v(\", \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[e._v('\"start\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"]\")]),e._v(\"\\n\")])])]),s(\"p\",[e._v(\"{% endcode %}\")]),e._v(\" \"),s(\"p\",[e._v(\"Save the changes. Now build and push the container to Docker Hub.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"docker\")]),e._v(\" build -t \"),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$DockerId\")]),e._v(\"/goof:dev \"),s(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[e._v(\".\")]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"docker\")]),e._v(\" push \"),s(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[e._v(\"$DockerId\")]),e._v(\"/goof:dev\\n\")])])]),s(\"p\",[e._v(\"Once it's done, test it in Kubernetes by scaling the \"),s(\"code\",[e._v(\"goof\")]),e._v(\" deployment with \"),s(\"code\",[e._v(\"kubectl\")]),e._v(\". The deployment's \"),s(\"code\",[e._v(\"ImagePullPolicy\")]),e._v(\" forces Kubernetes to pull the latest image from Docker Hub.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[e._v(\"kubectl scale deployment goof --replicas\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"0\")]),e._v(\"\\nkubectl scale deployment goof --replicas\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[e._v(\"1\")]),e._v(\"\\n\")])])]),s(\"p\",[e._v(\"Navigate to \"),s(\"a\",{attrs:{href:\"http://localhost:3001\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"http://localhost:3001\"),s(\"OutboundLink\")],1),e._v(\" to test the app. Success! It likes the new base image. In Docker Hub, we can appreciate the \"),s(\"code\",[e._v(\"dev\")]),e._v(\" tag has less vulnerabilities than \"),s(\"code\",[e._v(\"PROD\")]),e._v(\".\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/dockerhub-tagvulns%20%281%29.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"If you imported the project using the Kubernetes Monitor, you'll see the new results once the Snyk Monitor re-tests the project.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/k8sproject.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Let's get these changes into our GitHub Repo's PROD branch!\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"commit-the-changes-to-github-then-into-prod\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#commit-the-changes-to-github-then-into-prod\"}},[e._v(\"#\")]),e._v(\" Commit the changes to GitHub, then into PROD\")]),e._v(\" \"),s(\"h3\",{attrs:{id:\"commit-the-changes-to-the-develop-branch\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#commit-the-changes-to-the-develop-branch\"}},[e._v(\"#\")]),e._v(\" Commit the changes to the develop branch\")]),e._v(\" \"),s(\"p\",[e._v(\"First we need to commit the changes to our Repo's \"),s(\"code\",[e._v(\"develop\")]),e._v(\" branch. Use Git to do so.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"git\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"add\")]),e._v(\" Dockerfile\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"git\")]),e._v(\" commit -m \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[e._v('\"new base image\"')]),e._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[e._v(\"git\")]),e._v(\" push\\n\")])])]),s(\"h3\",{attrs:{id:\"open-a-pull-request-from-develop-to-prod\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#open-a-pull-request-from-develop-to-prod\"}},[e._v(\"#\")]),e._v(\" Open a Pull Request from develop to PROD\")]),e._v(\" \"),s(\"p\",[e._v(\"In GitHub, create a Pull Request from the \"),s(\"code\",[e._v(\"develop\")]),e._v(\" branch to the \"),s(\"code\",[e._v(\"PROD\")]),e._v(\" branch.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/gh-newpr.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/gh-pr-newbase.png\",alt:\"\"}})]),e._v(\" \"),s(\"h3\",{attrs:{id:\"see-the-pr-checks-we-configured-in-action\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#see-the-pr-checks-we-configured-in-action\"}},[e._v(\"#\")]),e._v(\" See the PR checks we configured in action\")]),e._v(\" \"),s(\"p\",[e._v(\"The workflows we configured earlier will run as part of this PR. You can see the results of the workflow runs in the PR view before choosing to Merge the PR. To recap what each one does:\")]),e._v(\" \"),s(\"ul\",[s(\"li\",[s(\"strong\",[e._v(\"license/snyk\")]),e._v(\" checks the incoming changes against the snapshot in Snyk for new license issues\")]),e._v(\" \"),s(\"li\",[s(\"strong\",[e._v(\"security/snyk\")]),e._v(\" checks the incoming changes against the snapshot in Snyk for new vulnerabilities\")]),e._v(\" \"),s(\"li\",[s(\"strong\",[e._v(\"Check for Open Source Vulnerabilities with Snyk\")]),e._v(\" checks if there are \"),s(\"strong\",[e._v(\"any\")]),e._v(\" vulnerable open source components in the application with fixes available\")]),e._v(\" \"),s(\"li\",[s(\"strong\",[e._v(\"CI Task for PROD Branch\")]),e._v(\" rebuilds and app and container to make sure it correctly builds.\")]),e._v(\" \"),s(\"li\",[s(\"strong\",[e._v(\"Code scanning results\")]),e._v(\" pushes the container scan results to GitHub Security for consumption.\")])]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/gh-prchecks%20%281%29.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Even though we have open source vulnerabilities, merge the PR. This triggers AutoBuild to build and re-scan the PROD container. When it completes, we see a reduction in the number of vulnerabilities.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/dockerhub-tags.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Choosing a more secure base image was just the start! In the next section, we'll address the application's vulnerable application dependencies.\")])])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}