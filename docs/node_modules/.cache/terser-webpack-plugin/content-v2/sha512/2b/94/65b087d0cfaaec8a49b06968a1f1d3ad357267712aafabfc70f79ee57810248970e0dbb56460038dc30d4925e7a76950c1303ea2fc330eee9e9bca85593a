{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{542:function(e,t,r){\"use strict\";r.r(t);var n=r(56),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[r(\"h1\",{attrs:{id:\"snyk-broker-code-agent\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#snyk-broker-code-agent\"}},[e._v(\"#\")]),e._v(\" Snyk Broker Code Agent\")]),e._v(\" \"),r(\"p\",[e._v('{% hint style=\"info\" %}\\nThis feature is currently in Beta. Please contact your CSM if you are interested in participating.\\n{% endhint %}')]),e._v(\" \"),r(\"p\",[e._v(\"You can natively connect Snyk Code to your local git server. This allows customers who are using a self-hosted git provider such as GitHub Enterprise or BitBucket Server to find, prioritize and fix potential vulnerabilities in their 1st-party code.\")]),e._v(\" \"),r(\"h2\",{attrs:{id:\"code-access-components\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#code-access-components\"}},[e._v(\"#\")]),e._v(\" Code access components\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[r(\"strong\",[e._v(\"Broker server\")]),e._v(\": Running on Snyk SaaS backend\")]),e._v(\" \"),r(\"li\",[r(\"strong\",[e._v(\"Broker client\")]),e._v(\": A \"),r(\"a\",{attrs:{href:\"https://hub.docker.com/r/snyk/broker/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Docker image\"),r(\"OutboundLink\")],1),e._v(\" deployed in your infrastructure.\")]),e._v(\" \"),r(\"li\",[r(\"strong\",[e._v(\"Code agent\")]),e._v(\": Another \"),r(\"a\",{attrs:{href:\"https://hub.docker.com/r/snyk/code-agent/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Docker image\"),r(\"OutboundLink\")],1),e._v(\" that is deployed in your infrastructure. \"),r(\"strong\",[e._v(\"Note:\")]),e._v(\" Code agent is only supported with \"),r(\"a\",{attrs:{href:\"https://docs.snyk.io/integrations/snyk-broker\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Snyk Broker\"),r(\"OutboundLink\")],1),e._v(\" v4.108.0 and later versions. If you have a running Broker client, pull the latest update.\")])]),e._v(\" \"),r(\"p\",[e._v(\"The \"),r(\"strong\",[e._v(\"Broker client\")]),e._v(\" and \"),r(\"strong\",[e._v(\"code agent\")]),e._v(\" components are deployed in your infrastructure, creating two separate services, responsible for cloning local repositories in a secured manner and sending the allied information to Snyk.\")]),e._v(\" \"),r(\"p\",[e._v(\"The Broker client provides the Agent with the connection details. The Agent uses these details to connect to your local git repository, clone the relevant files. And send the results through the brokered communications using callbacks. The brokered communication happens when a Broker client connects (using your Broker ID) to a Broker server running in Snyk environment:\")]),e._v(\" \"),r(\"p\",[r(\"img\",{attrs:{src:\"https://raw.githubusercontent.com/snyk/user-docs/main/docs/.gitbook/assets/local-git.png\",alt:\"\"}})]),e._v(\" \"),r(\"p\",[e._v(\"See \"),r(\"a\",{attrs:{href:\"https://docs.snyk.io/integrations/snyk-broker/broker-introduction\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Snyk Broker\"),r(\"OutboundLink\")],1),e._v(\" documentation for more details.\")]),e._v(\" \"),r(\"h2\",{attrs:{id:\"setup\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#setup\"}},[e._v(\"#\")]),e._v(\" Setup\")]),e._v(\" \"),r(\"h3\",{attrs:{id:\"prerequisites\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\"}},[e._v(\"#\")]),e._v(\" Prerequisites\")]),e._v(\" \"),r(\"p\",[e._v(\"Before you begin with the setup process, make sure to have a server that supports these minimal requirements for running the Broker client and Code agent:\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[e._v(\"CPU: 1 vcpu\")]),e._v(\" \"),r(\"li\",[e._v(\"Memory: 2Gb (should be reflected in node memory setting)\")]),e._v(\" \"),r(\"li\",[e._v(\"Disk space: 2Gb (available disk size determines maximum cloneable repository size)\")]),e._v(\" \"),r(\"li\",[e._v(\"Network: code upload performance will be affected by slow Internet connection\")])]),e._v(\" \"),r(\"h3\",{attrs:{id:\"set-up-broker-client\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#set-up-broker-client\"}},[e._v(\"#\")]),e._v(\" Set up broker client\")]),e._v(\" \"),r(\"p\",[e._v(\"Code agent depends on broker client. Follow the instructions on \"),r(\"RouterLink\",{attrs:{to:\"/snyk/features/integrations/snyk-broker/set-up-snyk-broker/how-to-install-and-configure-your-snyk-broker-client.html\"}},[e._v(\"How to install and configure your Snyk Broker client\")]),e._v(\" for detailed instructions how to set up broker for specific SCMs.\")],1),e._v(\" \"),r(\"p\",[e._v(\"If you already have a broker client running, consider the following additional requirements:\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[e._v(\"Code agent is only supported with \"),r(\"RouterLink\",{attrs:{to:\"/snyk/features/integrations/snyk-broker/\"}},[e._v(\"Snyk Broker\")]),e._v(\" v4.108.0 and later versions, make sure to pull the latest version first.\")],1),e._v(\" \"),r(\"li\",[e._v(\"Code agent needs permission to clone the full repository, make sure that the SCM token passed to the broker has the corresponding permissions.\")])]),e._v(\" \"),r(\"h3\",{attrs:{id:\"set-up-the-network\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#set-up-the-network\"}},[e._v(\"#\")]),e._v(\" Set up the network\")]),e._v(\" \"),r(\"p\",[e._v(\"To run both the broker client and the broker agent, establish a network connection between them. There are different solutions to expose one container connection with tools like Ngrok (which is also possible here if you want), but this description focuses on docker bridge networks.\")]),e._v(\" \"),r(\"p\",[e._v(\"Run \"),r(\"strong\",[r(\"code\",[e._v(\"docker network create <network>\")])])]),e._v(\" \"),r(\"p\",[e._v(\"For example:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"docker network create mySnykBrokerNetwork\\n\")])])]),r(\"p\",[e._v(\"You can confirm that it was created by running \"),r(\"strong\",[r(\"code\",[e._v(\"docker network ls\")])]),e._v(\", this will show results like this:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"  NETWORK ID     NAME                 DRIVER     SCOPE\\n  d1353a2b0f66   mySnykBrokerNetwork  bridge     local\\n\")])])]),r(\"h3\",{attrs:{id:\"set-up-code-agent\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#set-up-code-agent\"}},[e._v(\"#\")]),e._v(\" Set up Code Agent\")]),e._v(\" \"),r(\"p\",[e._v(\"First, pull the code-agent image:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"docker pull snyk/code-agent\\n\")])])]),r(\"p\",[e._v(\"The following environment variables are mandatory to configure the code agent:\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[r(\"strong\",[e._v(\"SNYK_TOKEN -\")]),e._v(\" your snyk token, as also used by the CLI, see \"),r(\"a\",{attrs:{href:\"https://raw.githubusercontent.com/snyk/user-docs/main/docs/../snyk-cli/authenticate-the-cli-with-your-account/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Authenticate the CLI with your account\"),r(\"OutboundLink\")],1),e._v(\" for additional details.\")]),e._v(\" \"),r(\"li\",[r(\"strong\",[e._v(\"PORT\")]),e._v(\" - the local port, for which the code agent accepts connections, Default is 3000.\")])]),e._v(\" \"),r(\"p\",[e._v(\"To run the \"),r(\"strong\",[e._v(\"code-agent:\")])]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"docker run --name code-agent \\\\\\n     -p 3000:3000 \\\\\\n     -e PORT=3000 -e SNYK_TOKEN=<token> --network mySnykBrokerNetwork \\\\\\n     snyk/code-agent\\n\")])])]),r(\"p\",[e._v(\"In this example:\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[e._v(\"We set the current container to use the new network we created \"),r(\"strong\",[e._v(\"--network mySnykBrokerNetwork\")])]),e._v(\" \"),r(\"li\",[e._v(\"We gave the current container a name \"),r(\"strong\",[e._v(\"--name code-agent\")]),e._v(\". It will be used to define the \"),r(\"strong\",[e._v(\"GIT_CLIENT_URL\")]),e._v(\" for the broker client that we will run next.\")])]),e._v(\" \"),r(\"h3\",{attrs:{id:\"extend-broker-setup\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#extend-broker-setup\"}},[e._v(\"#\")]),e._v(\" Extend Broker setup\")]),e._v(\" \"),r(\"p\",[e._v(\"Extend your broker setup with the following arguments:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"-e GIT_CLIENT_URL=http://<code agent container>:<code agent port>\\n--network <name of created network>\\n\")])])]),r(\"p\",[e._v(\"For example, to extend an existing broker client configured for Gitlab, run:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"docker run \\\\\\n   -p 8001:8000 \\\\\\n   -e BROKER_TOKEN=xxxxxxx-xxxx-xxxx-xxxx-xxxxxxx \\\\\\n   -e GITLAB_TOKEN=glpat-xxxxxxxxxxxxxxx \\\\\\n   -e GITLAB=url.com \\\\\\n   -e BROKER_CLIENT_URL=http://my.broker.client:8000\\n   -e PORT=8000 \\\\\\n   -e GIT_CLIENT_URL=http://code-agent:3000 \\\\\\n   --network mySnykBrokerNetwork \\\\\\n   -e ACCEPT=/private/accept.json \\\\\\n   -v /path/to/private:/private \\\\\\n   snyk/broker:gitlab\\n\")])])]),r(\"p\",[e._v(\"In this example:\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[e._v(\"We set the current container to use the new network we created \"),r(\"strong\",[e._v(\"--network mySnykBrokerNetwork\")])]),e._v(\" \"),r(\"li\",[e._v(\"In \"),r(\"strong\",[e._v(\"GIT_CLIENT_URL\")]),e._v(\" we used the name we defined in the code-agent container as the host here.\")])]),e._v(\" \"),r(\"p\",[e._v(\"If you have a running Snyk broker with a custom whitelist (\"),r(\"strong\",[e._v(\"accept.json\")]),e._v(\"), then ensure the following rule is present in the whitelist:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v('{\\n  \"//\": \"used to redirect requests to snyk git client\",\\n  \"method\": \"any\",\\n  \"path\": \"/snykgit/*\",\\n  \"origin\": \"${GIT_CLIENT_URL}\"\\n}\\n')])])]),r(\"p\",[e._v(\"(The rule is present by default, so only needed if you override the rule with a custom whitelist.)\")]),e._v(\" \"),r(\"h2\",{attrs:{id:\"advanced-settings\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#advanced-settings\"}},[e._v(\"#\")]),e._v(\" Advanced Settings\")]),e._v(\" \"),r(\"h3\",{attrs:{id:\"enable-code-snippets\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#enable-code-snippets\"}},[e._v(\"#\")]),e._v(\" Enable code snippets\")]),e._v(\" \"),r(\"p\",[e._v(\"To enable code snippets, additional rules must be added to \"),r(\"strong\",[e._v(\"accept.json\")]),e._v(\".\")]),e._v(\" \"),r(\"p\",[e._v(\"See \"),r(\"a\",{attrs:{href:\"https://github.com/snyk/broker#custom-approved-listing-filter\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://github.com/snyk/broker#custom-approved-listing-filter\"),r(\"OutboundLink\")],1),e._v(\" for detailed instructions how to extend \"),r(\"strong\",[e._v(\"accept.json\")]),e._v(\".\")]),e._v(\" \"),r(\"p\",[e._v(\"For GitHub:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v('{\\n  \"//\": \"needed to load code snippets\",\\n  \"method\": \"GET\",\\n  \"path\": \"/repos/:name/:repo/contents/:path\",\\n  \"origin\": \"https://${GITHUB_TOKEN}@${GITHUB_API}\"\\n}\\n')])])]),r(\"p\",[e._v(\"For Gitlab:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v('{\\n  \"//\": \"needed to load code snippets\",\\n  \"method\": \"GET\",\\n  \"path\": \"/api/v4/projects/:project/repository/files/:path\",\\n  \"origin\": \"https://${GITLAB}\"\\n}\\n')])])]),r(\"p\",[e._v(\"For BitBucket Server:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v('{\\n    \"//\": \"needed to load code snippets\",\\n      \"method\": \"GET\",\\n      \"path\": \"/projects/:project/repos/:repo/browse*/:file\",\\n      \"origin\": \"https://${BITBUCKET_API}\",\\n      \"auth\": {\\n        \"scheme\": \"basic\",\\n        \"username\": \"${BITBUCKET_USERNAME}\",\\n        \"password\": \"${BITBUCKET_PASSWORD}\"\\n      }\\n}\\n')])])]),r(\"p\",[e._v(\"For Azure Repos:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v('{\\n      \"//\": \"needed for code snippets\",\\n      \"method\": \"GET\",\\n      \"path\": \"/:owner/_apis/git/repositories/:repo/items\",\\n      \"origin\": \"https://${AZURE_REPOS_HOST}/${AZURE_REPOS_ORG}\",\\n      \"auth\": {\\n        \"scheme\": \"basic\",\\n        \"token\": \"${BROKER_CLIENT_VALIDATION_BASIC_AUTH}\"\\n      }\\n}\\n')])])]),r(\"p\",[e._v('{% hint style=\"info\" %}\\nAfter these snippets are added, all content from the repository can be accessed through Snyk broker.\\n{% endhint %}')]),e._v(\" \"),r(\"h3\",{attrs:{id:\"proxy-support\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#proxy-support\"}},[e._v(\"#\")]),e._v(\" Proxy support\")]),e._v(\" \"),r(\"p\",[e._v(\"For instructions how to run Broker client through a proxy, see \"),r(\"a\",{attrs:{href:\"https://github.com/snyk/broker\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://github.com/snyk/broker\"),r(\"OutboundLink\")],1),e._v(\". Make sure that requests to the Code agent are not sent through the proxy, by passing \"),r(\"code\",[e._v(\"NO_PROXY=<code agent container>\")]),e._v(\", for example:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"-e HTTP_PROXY=http://my.proxy.address:8080\\n-e HTTPS_PROXY=http://my.proxy.address:8080\\n-e NO_PROXY=code-agent\\n\")])])]),r(\"p\",[e._v(\"For code agent, add the following environment variables to the \"),r(\"strong\",[e._v(\"docker run\")]),e._v(\" command:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"-e HTTP_PROXY=http://my.proxy.address:8080\\n-e HTTPS_PROXY=http://my.proxy.address:8080\\n\")])])]),r(\"p\",[e._v(\"To disable certificate verification, e.g., in the case of self-signed certificates, add to the code-agent \"),r(\"strong\",[e._v(\"docker run\")]),e._v(\" command:\")]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"-e NODE_TLS_REJECT_UNAUTHORIZED=0\\n\")])])])])}),[],!1,null,null,null);t.default=o.exports}}]);","extractedComments":[]}