{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[822],{1222:function(e,t,s){\"use strict\";s.r(t);var a=s(56),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"ensure-deployment-manifests-are-free-from-misconfiguration\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#ensure-deployment-manifests-are-free-from-misconfiguration\"}},[e._v(\"#\")]),e._v(\" Ensure deployment manifests are free from misconfiguration\")]),e._v(\" \"),s(\"p\",[e._v(\"In the previous sections we fixed vulnerabilities introduced by the container base image and the application dependencies, and tested our changes by deploying to Kubernetes.\")]),e._v(\" \"),s(\"p\",[e._v(\"Even with 0 vulnerabilities, we can expose ourselves to risk by how our application's deployment manifests are written. In this section we'll use Snyk to find and fix issues in those files.\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"investigate-issues-in-deployment-manifests\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#investigate-issues-in-deployment-manifests\"}},[e._v(\"#\")]),e._v(\" Investigate issues in deployment manifests\")]),e._v(\" \"),s(\"p\",[e._v(\"In the Snyk project imported earlier, we can see the two Kubernetes manifests for the goof application. One deploys the application, and the other deploys the mongo database it needs.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/snyk-iac-dockerlab.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Clicking into either one of these brings you to the configuration risks Snyk identified in the file. Starting with the \"),s(\"code\",[e._v(\"goof-mongo-deployment.yaml\")]),e._v(\" file, we see the following issues:\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/goof-mongo-issues.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"For each issue, Snyk calls out the issue identified, its impact, and how it can be resolved. It also highlights the line of code where the issue exists. In the example below, we see a Low Severity configuration risk that can be addressed by adding an \"),s(\"code\",[e._v(\"ImagePullPolicy\")]),e._v(\" to the deployment.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/iac-pullpolicyissue.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"With this information, developers can either ignore the issue or make the necessary changes to their deployment manifests to fix them.\")]),e._v(\" \"),s(\"p\",[e._v(\"{% hint style=\\\"danger\\\" %}\\nThese are examples. It's possible your application requires administrative privileges or other explicitly stated privileges. Know your application and its dependencies before making changes to your files; you can break your deployment if you're not careful.\\n{% endhint %}\")]),e._v(\" \"),s(\"h2\",{attrs:{id:\"fixing-configuration-issues-in-deployment-manifests\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fixing-configuration-issues-in-deployment-manifests\"}},[e._v(\"#\")]),e._v(\" Fixing configuration issues in deployment manifests\")]),e._v(\" \"),s(\"p\",[e._v(\"As the warning states, configuration issues are very nuanced. While there are documented best practices we check against, your workloads might require those in order to function correctly. For this reason, we allow you to \"),s(\"a\",{attrs:{href:\"https://support.snyk.io/hc/en-us/articles/360006402818#UUID-c1919782-6bfa-b84b-a638-3913cee39fc5\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"change the severities for the configuration checks\"),s(\"OutboundLink\")],1),e._v(\" Snyk runs.\")]),e._v(\" \"),s(\"p\",[e._v(\"In this example, we'll fix a few issues we deem important enough to warrant a fix.\")]),e._v(\" \"),s(\"h3\",{attrs:{id:\"issue-container-could-be-running-with-outdated-image\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#issue-container-could-be-running-with-outdated-image\"}},[e._v(\"#\")]),e._v(\" Issue: Container could be running with outdated image\")]),e._v(\" \"),s(\"p\",[e._v(\"Let's look once again at the issue from above.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/iac-pullpolicyissue.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"Reading the issue description, this issue can be fixed by adding an \"),s(\"code\",[e._v(\"ImagePullPolicy\")]),e._v(\" attribute to the \"),s(\"code\",[e._v(\"containers\")]),e._v(\" spec. In your IDE, or text editor, add the attribute to \"),s(\"code\",[e._v(\"goof-mongo-deployment.yaml\")]),e._v(\".\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"spec\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"containers\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"image\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" mongo\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" goof\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"mongo\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"imagePullPolicy\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" Always\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"ports\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n\")])])]),s(\"h3\",{attrs:{id:\"issue-container-is-running-without-root-user-control\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#issue-container-is-running-without-root-user-control\"}},[e._v(\"#\")]),e._v(\" Issue: Container is running without root user control\")]),e._v(\" \"),s(\"p\",[e._v(\"Let's look at another issue. This time, it has to do with the permissions given to the container.\")]),e._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://partner-workshop-assets.s3.us-east-2.amazonaws.com/iac-runasnoonroot.png\",alt:\"\"}})]),e._v(\" \"),s(\"p\",[e._v(\"This one can be fixed by setting a \"),s(\"code\",[e._v(\"securityContext\")]),e._v(\" on the \"),s(\"code\",[e._v(\"container\")]),e._v(\". To set this, add the following to the \"),s(\"code\",[e._v(\"goof-deployment-mongo.yaml\")]),e._v(\" file.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"spec\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"containers\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"image\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" mongo\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" goof\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"mongo\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"imagePullPolicy\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" Always\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"securityContext\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[e._v(\"runAsNonRoot\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\":\")]),e._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[e._v(\"true\")]),e._v(\"\\n\")])])]),s(\"h2\",{attrs:{id:\"test-your-config-files-to-ensure-they-work\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#test-your-config-files-to-ensure-they-work\"}},[e._v(\"#\")]),e._v(\" Test your config files to ensure they work\")]),e._v(\" \"),s(\"p\",[e._v(\"Any time you make a local change to a configuration file, it's a good idea to test it locally before committing the changes to GitHub. Tear down the current deployment by deleting the namespace:\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[e._v(\"kubectl delete ns snyk\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"docker\\n\")])])]),s(\"p\",[e._v(\"Once it's gone, re-deploy the application using the following commands.\")]),e._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Create a namespace\")]),e._v(\"\\nkubectl create ns snyk\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"docker\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Set the current context to use the new namespace\")]),e._v(\"\\nkubectl config set\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"context \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"current \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"namespace snyk\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"docker\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[e._v(\"# Spin up the goof deployment and service\")]),e._v(\"\\nkubectl create \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"f goof\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"deployment.yaml\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\",\")]),e._v(\"goof\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"mongo\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[e._v(\"-\")]),e._v(\"deployment.yaml\\n\")])])]),s(\"p\",[e._v(\"If it spins up correctly, test the app by navigating to \"),s(\"a\",{attrs:{href:\"http://localhost:3001\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"http://localhost:3001\"),s(\"OutboundLink\")],1),e._v(\". Once you've confirmed it works, commit the changes to GitHub! Snyk will re-test the files and show updated issue counts.\")]),e._v(\" \"),s(\"p\",[e._v(\"You reached the end! We hope you enjoyed it. Check out \"),s(\"RouterLink\",{attrs:{to:\"/snyk/tutorials/docker/lab-build-secure-containers-with-docker-and-snyk/recap-and-next-steps.html\"}},[e._v(\"Recap and Next Steps\")]),e._v(\" for extra resources.\")],1)])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}